<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>test</title>
<script src="http://yandex.st/jquery/1.11.0/jquery.min.js"></script>
<script src="libs/html2canvas.js"></script>
<script src="libs/colorPicker.js"></script>
<link href="css/colorPicker.css" media="all" rel="stylesheet" type="text/css">
<!-- <script src="http://yandex.st/jquery-ui/1.10.4/jquery-ui.min.js"></script>
<script src="libs/iris/dist/iris.min.js"></script> -->
<style>


/*Basic Reset*/
* {margin: 0; padding: 0;}

body {
    /* overflow: hidden; */
    color:white;
    font: 0.92em/1.4 Verdana, Arial, sans-serif
}



h1 {
    color: white;
    width: 500px;
    padding: 50px;
}

h2 {
    font-weight: normal;
    margin-bottom:1em;
}

p {
    margin-bottom: 2em
}

.prev-container {
    background: #19c4eb;
    overflow: hidden;
    color:white;
    
    position: absolute;
    top:0;
    bottom:0;
    left: 0;
    right: 0;

    -webkit-perspective: 1000px;
    -moz-perspective: 1000px;
    perspective: 1000;
}

.grid {
    position: absolute; 
    top: 40px; 
    left: 200px;
    width: 500px;

    -webkit-transform: rotateX(30deg) rotateZ(-40deg);
    transform: rotateX(30deg) rotateZ(-40deg);

    -webkit-transform-style: preserve-3d;
    transform-style: preserve-3d;
}
.grid li {
    height: 370px; width: 370px;
    float: left; margin: 20px;
    list-style-type: none;
    background-size: 0, cover;

    -webkit-transform-style: preserve-3d;
    transform-style: preserve-3d;
}

.grid li:before, .grid li:after {
    content: '';
    position: absolute;
    /*100% height and width*/
    top: 0; left: 0; right: 0; bottom: 0;
    background: inherit;
    background-size: cover;
}

.grid li:before {
    -webkit-transform-origin:left center;
    transform-origin: left center;

    -webkit-transform: rotateY(90deg);
    transform: rotateY(90deg);

    width: 5px;
}

.grid li:after {
    -webkit-transform-origin:bottom center;
    transform-origin: bottom center;

    -webkit-transform: rotateX(90deg);
    transform: rotateX(90deg);

    height: 5px; 
    top: auto; 
    bottom: 0;

    background-position: bottom center;
}

.shadow {
    position: absolute;

    top: 30px; 
    left: 30px; 
    right: 30px; 
    bottom: 30px;

    background: rgba(0, 0, 0, 0.5);
    box-shadow: 0 0 30px 30px rgba(0, 0, 0, 0.5);

    -webkit-transform: translateZ(-50px);
    transform: translateZ(-50px);
}

.preview {
    background: 
        linear-gradient(45deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.5)), 
        url("http://scr1.templatemonster.com/47900/47929-med.jpg");
}

.hidden-image {visibility: hidden}

.controls {

    padding:2em;
}
.clearfix:after {
    content:'';
    clear:both;
}

.colomn {
    float:left;
    min-width: 220px;
    margin-right: 2em
}

/* #canvas-container {position:absolute; top:100%;} */
#hide-panel {
    width:50px;
    height:20px;
    position:absolute;
    top:-20px;
    left:2em;
    text-align: center;
    background-color: rgba(0, 0, 0, 0.3);
    padding:0 1em;
    color:white;
}

#hide-panel a {
    text-decoration: none;
    color:white;
}

.footer {
    position: absolute;
    bottom:0; left:0; right:0;
    background-color: rgba(0, 0, 0, 0.3);
}

</style>

</head>

<body>

<div class="prev-container" id="preview-container">
    <ul class="grid">
        <li class="preview"><span class="shadow"></span></li>
    </ul>
</div>

<div class="footer">
<div class="controls clearfix">
    <div class="colomn">
        <p>
            Your image URL:<br>
            <input type="text" id="preview-image" value="">
        </p>

        <p>
            Perspective:<br>
            <input type="text" id="body-perspective" value="1000"> px
        </p>
    </div>

    <div class="colomn">
        <p>
            Grid transforme:<br>
            X: <input type="text" id="grid-x-transformer" value="30"> deg<br>
            Z: <input type="text" id="grid-z-transformer" value="-40"> deg
        </p>

        <p>
            Shadow position:<br>
            Z: <input type="text" id="shadow-transform-z" value="-50"> px
        </p>
    </div>

    <div class="colomn">
        <p>
            Background color:<br>
            <input type="text" id="background-color" value="#19c4eb">
        </p>
        <!-- <p><input type="button" value="Make picture (PNG)" id="make-a-picture"></p> -->
    </div>

    <div class="colomn">
        <h2>Simple CSS3 preview generator</h2>
        <p>
            Hello!<br>
            My name is Alex and it's a simple CSS 3d picture generator.<br>
            It can be interesting for you, if you are designer, or, for example, if you prepare a presentation.
        </p>
        <p>Any case, just cpecify your picture and make a screenshot!</p>
        <p><a href="mailto:alexandr.deineko@gmail.com">alexandr.deineko@gmail.com</a></p>
    </div>
</div>
<div id="hide-panel"><a href="#">hide</a></div>
</div>

<script>
    $(function() {
        var jqElems = {
                $previewBody: $('#preview-container'),
                
                $bodyPerspectiveControl: $('#body-perspective'),

                $grid:$('.grid'),
                $gridTransformX:$('#grid-x-transformer'),
                $gridTransformZ:$('#grid-z-transformer'),

                $image: $('.preview'),
                $imagePreview: $('#preview-image'),

                $shadow: $('.shadow'),
                $shadowTransformZ: $('#shadow-transform-z'),

                $backgroundColor: $('#background-color'),

                $controlsPanel: $('.controls'),
                $controlsToggler: $('#hide-panel')

                /* button to make a div - in PNG picture, so  */
                /*$makePicture: $('#make-a-picture')*/
            };

        /**
         * Body perspective controls
         */
        jqElems.$bodyPerspectiveControl.on('change input', function() {
            var newPerspectiveValue = $(this).val();

            jqElems.$previewBody.css({
                '-webkit-perspective': newPerspectiveValue + 'px',
                '-moz-perspective': newPerspectiveValue + 'px',
                'perspective': newPerspectiveValue
            });
        });


        /**
         * Shadow Z pozition
         */
        jqElems.$shadowTransformZ.on('change input', function() {
            var newShadowZ = $(this).val();

            jqElems.$shadow.css({
                '-webkit-transform': 'translateZ(' + newShadowZ + 'px)',
                'transform': 'translateZ(' + newShadowZ + 'px)'
            });
        });


        /**
         * Background color setter
         */

        var setBgColor = function(color) {
            jqElems.$previewBody.css({
                'background': color
            });
        };
        jqElems.$backgroundColor.colpick({
            layout:'hex',
            submit:0,
            onChange:function(hsb, hex, rgb, el, bySetColor) {
                // Fill the text box just if the color was set using the picker, and not the colpickSetColor function.
                if(!bySetColor) $(el).val('#' + hex);
                setBgColor( '#' + hex );
            }
        });
        jqElems.$backgroundColor.on('change', function() {
            setBgColor( $(this).val() );
        });


        /**
         * Grid X and Z transform controls
         */
        $.each([jqElems.$gridTransformX, jqElems.$gridTransformZ], function(){
            $(this).on('change input', function() {
                console.log('234');
                var newTransformXValue = jqElems.$gridTransformX.val(),
                    newTransformZValue = jqElems.$gridTransformZ.val();

                jqElems.$grid.css({
                    '-webkit-transform': 'rotateX(' + newTransformXValue + 'deg)' + ' rotateZ(' + newTransformZValue + 'deg)',
                    'transform': 'rotateX(' + newTransformXValue + 'deg)' + ' rotateZ(' + newTransformZValue + 'deg)'
                });
            });
        });


        /**
         * Setting your own image
         * that should be stored on the web
         */
        jqElems.$imagePreview.on('change input', function() {
                /**
                 * Getting image new sizes
                 *
                 * @param img - jquery DOM img object
                 */
            var newImageSizes = function(img) {
                    return {
                        width: img.width(),
                        height: img.height()
                    };
                },
                /**
                 * Creating new invisible for client img element to get it`s sizes
                 *
                 * @param {String} imgAddress - new image address
                 * @returns {Object} dimensions - width and height if a new image
                 */
                createNewImage = function(imgAddress) {
                    /*killing all old elements*/
                    $('.hidden-image').remove();

                    var $newImg = $('<img src="' + imgAddress + '" class="hidden-image">'),
                        newDimensions;

                    jqElems.$previewBody.append($newImg);

                    $newImg.on('load', function() {
                        newDimensions = newImageSizes($(this));

                        jqElems.$image.css({
                            'width': newDimensions.width + 'px',
                            'height': newDimensions.height + 'px',
                            'background': 'url("' + newImageAddress + '")'
                        });

                    });
                },
                newImageAddress = $(this).val();

            createNewImage( newImageAddress );
        });

        /**
         * Make a picture functionality
         *
         */
        /*jqElems.$makePicture.on('click', function() {
            html2canvas(document.body, {
                onrendered: function(canvas) {
                    console.log(canvas);
                    document.getElementById('canvas-container').appendChild(canvas);
                }
            });
        });*/


        /**
         * Show or hide control panel
         *
         */
         jqElems.$controlsToggler.on('click', function(e){
            var text = $(this).find('a').text();
            console.log(text);
            e.preventDefault();

            jqElems.$controlsPanel.slideToggle('fast');
            $(this).find('a').text( text === 'hide' ? 'show' : 'hide' );
         });
    });
</script>

</body>
</html>